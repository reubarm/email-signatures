"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const types_1 = require("./types");
const get_dependencies_reg_exps_1 = require("../utils/get-dependencies-reg-exps");
const remove_quotes_1 = require("../utils/remove-quotes");
function getImportsGroupPredicate(sourceFile, matchingRuleConfig) {
    if (matchingRuleConfig.type === types_1.ImportsGroupType.Dependencies) {
        return getDependenciesImportsGroupPredicate(sourceFile, matchingRuleConfig);
    }
    return getProjectImportsGroupPredicate(sourceFile, matchingRuleConfig);
}
exports.getImportsGroupPredicate = getImportsGroupPredicate;
const getProjectImportsGroupPredicate = (sourceFile, matchingRuleConfig) => importDeclarationMatchesRegExpsFactory(sourceFile, [
    new RegExp(matchingRuleConfig.matches)
]);
function getDependenciesImportsGroupPredicate(sourceFile, matchingRuleConfig) {
    const regExps = matchingRuleConfig['from-package.json']
        ? get_dependencies_reg_exps_1.getPackageJsonDependenciesRegExps()
        : get_dependencies_reg_exps_1.getNodeModulesRegExps();
    if (!matchingRuleConfig['disable-native-nodejs-modules']) {
        regExps.push(...get_dependencies_reg_exps_1.getNodeJsModulesRegExps());
    }
    return importDeclarationMatchesRegExpsFactory(sourceFile, regExps);
}
const importDeclarationMatchesRegExpsFactory = (sourceFile, regExps) => node => regExps.some(regExp => regExp.test(getModuleSpecifier(sourceFile, node)));
function getModuleSpecifier(sourceFile, node) {
    return remove_quotes_1.removeQuotes(node.moduleSpecifier.getText(sourceFile));
}
