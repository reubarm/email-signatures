# üìè Geometry Web üìê

[![CircleCI](https://circleci.com/gh/EqualsGroup/geometry-web/tree/master.svg?style=svg)](https://circleci.com/gh/EqualsGroup/geometry-web/tree/master)

## Description

This repository is contains the Geometry React Web Components used in our new world applications. The stack used is React, Typescript and emotion styled.
Unit tests are using the React testing library.
Visual regression tests are using Chromatic coupled with Storybook.
Releases are performed automatically and using Semantic release

### Design

The design source of truth is the [Geometry - Web Apps Design System](https://www.figma.com/file/HbmVFbvCJVmVSmy0btuvrf/Geometry-Web-Apps-Design-System?node-id=1080%3A25) figma file. Use this file as your guide when building new components.

### Environment and Tools

- Node (We recommend lts)
- [React](https://reactjs.org/docs/getting-started.html)
- [Typescript](https://www.typescriptlang.org/)
- [Yarn](https://yarnpkg.com/)
- [React testing library](https://testing-library.com/docs/react-testing-library/intro)
- [Chromatic](https://www.chromaticqa.com/)
- [Semantic release](https://semantic-release.gitbook.io/semantic-release/)

## Development Guide

### Install dependencies

The package manager of choice is yarn. Please do not use npm, and make sure your yarn version is up to date (`lts` recommended).

To install all dependencies in the package.json file

```bash
yarn install
```

To install a package

```bash
yarn add <package>[@version] [--dev]
```

Also see the [yarn documentation](https://yarnpkg.com/lang/en/docs/cli/add/).

or just add the dependency directly to the package.json and rerun yarn.

### Run

Run the storybook

```bash
yarn storybook
```

Storybook will open a page automatically on your browser.

### Branches

The repo uses [Git workflow](https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow).

Our 1 persistent branch represent the latest version of the design system:

- `master`: production

Changes to the codebase - through `master` - are introduced using pull-requests (PR).

### Release

Once your pull-request is merged on `master`:

- Circle CI will rerun the build
- Semantic release will analyse your commits and decide what will be the appropriate version number
- New version will be released for `@fairfx/geometry-web`

### Code changes

Every change must go through the following steps:

- PR
- Successful CI/CD build
- Approved Chromatic changes
- Squash and merge to master

### PRs

Create a feature-branch from the latest `master` with the following name template: `(feature|bugfix)/(PROJECT-CODE)-(ticket-number)-[short-summary]` (ticket number + summary).

_Corgi pictures are appreciated but not mandatory. Also always nicer to provide before/after screenshots for your changes, or a gif (you can use a soft called licecap for this on Mac OS)._

Approved pull requests get squashed into `master`.

### Commits

Commits in feature branches follow the [conventional commits](https://www.conventionalcommits.org) specification.

If your work is not attached to any JIRA ticket, you can use `NO_JIRA` instead of the ticket id.

### Testing

We follow test-driven principles, so please avoid committing to the repo using the `--no-verify` option. This will insure you never push code that is not prettified, linted, and that does not come with green specs.

The repo uses [React testing library](https://testing-library.com/docs/react-testing-library/intro) for unit tests and [Chromatic](https://www.chromaticqa.com/) for visual regression tests.

#### Run unit tests

```bash
yarn test
```

#### Run unit tests and upgrade snapshots

```bash
yarn test -u
```

#### Test coverage

The final stage of every test run is **_test coverage collection_**.

Test coverage has a bare minimum level to be maintained (threshold), which is defined for each metric: branches, functions, lines and statements.

The current thresholds could be found in `./jest.config.js` and are subject to review and increase over time.

> NOTE: Your CI build is likely to fail and PR won't be allowed to be merged unless coverage is maintained.

### CI/CD

The repo uses [CircleCI](https://circleci.com/gh/EqualsGroup/geometry-web) for continuous delivery.

A PR created with the above convention creates a CircleCI build for immediate feedback on the feature/fix. The build must pass before a PR can be merged.

### Now integration

This repository is integrating `Now` V2 for opened PRs. You can access the `Now` deploy on your pull requests by clicking on the `Now` Github integration check. You can also deploy manually by running `now` from the project root level.

When changes are merged to master, `Now` will deploy changes on a [production url](https://everest-jet-eta.now.sh/)

### Additional yarn scripts for devs

Run production build manually - _useful for reproducing production or now build errors_

```bash
yarn build
```

Run typescript linter manually - _useful for fixing lint issues before pushing_

```bash
yarn lint
```

Run prettier manually - _useful for formatting your code when coding (will be ran on commit otherwise)_

```bash
yarn prettier
```

Run chromatic manually - _useful for checking visual regression builds before pushing_

```bash
yarn chromatic
```
